<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.jlumart.mapper.OrderMapper">
    <insert id="insert">
        INSERT INTO SHOPPING_ORDERS (ORDER_ID, USER_ID, RECEIVER_NAME, RECEIVER_GENDER, RECEIVER_PHONE,
                                     RECEIVER_ADDRESS, ITEMS, REMARK, TOTAL_AMOUNT, DELIVERY_FEE, DELIVERY_DISTANCE,
                                     ESTIMATED_DELIVERY_TIME, CREATE_TIME, UPDATE_TIME)
        VALUES (#{orderId}, #{userId}, #{receiverName}, #{receiverGender}, #{receiverPhone}, #{receiverAddress},
                #{items}, #{remark}, #{totalAmount}, #{deliveryFee}, #{deliveryDistance}, #{estimatedDeliveryTime},
                #{createTime}, #{updateTime})
    </insert>
    <update id="update">
        UPDATE SHOPPING_ORDERS
        <set>
            <if test="status != null">
                STATUS = #{status},
            </if>
            <if test="cancelReason != null">
                CANCEL_REASON = #{cancelReason},
            </if>
            <if test="courierId != null">
                COURIER_ID = #{courierId},
            </if>
            <if test="courierName != null">
                COURIER_NAME = #{courierName},
            </if>
            <if test="deliveryTime != null">
                DELIVERY_TIME = #{deliveryTime},
            </if>
            <if test="updateTime != null">
                UPDATE_TIME = #{updateTime},
            </if>
        </set>
        <where>
            <if test="id != null">
                ID = #{id}
            </if>
            <if test="orderId != null and orderId != ''">
                AND ORDER_ID = #{orderId}
            </if>
            <if test="userId != null">
                AND USER_ID = #{userId}
            </if>
        </where>
    </update>
    <select id="page" resultType="com.jlumart.entity.ShoppingOrder">
        SELECT ID, ORDER_ID, TOTAL_AMOUNT, CREATE_TIME, STATUS, ITEMS
        FROM SHOPPING_ORDERS
        <where>
            <if test="orderId != null and orderId != ''">
                AND ORDER_ID = #{orderId}
            </if>
            <if test="userId != null">
                AND USER_ID = #{userId}
            </if>
            <if test="status != null">
                AND STATUS = #{status}
            </if>
        </where>
        ORDER BY CREATE_TIME DESC
    </select>
    <select id="countByStatus" resultType="java.lang.Long">
        SELECT COUNT(1)
        FROM SHOPPING_ORDERS
        <where>
                STATUS = #{status}
            <if test="userId != null">
                AND USER_ID = #{userId}
            </if>
        </where>
    </select>

</mapper>